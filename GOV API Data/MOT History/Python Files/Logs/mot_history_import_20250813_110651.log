2025-08-13 11:06:51,838 - MOTHistoryImport - INFO - Logging initialized. Log file: Logs\mot_history_import_20250813_110651.log
2025-08-13 11:06:51,840 - MOTHistoryImport - INFO - Configuration loaded: {'database': {'server': 'MLNOESQLUAT01', 'database': 'Engineering', 'trusted_connection': True}, 'files': {'log_directory': 'Logs'}, 'processing': {'batch_size': 100, 'request_timeout': 30, 'max_retries': 3}, 'logging': {'log_level': 'DEBUG'}, 'security': {'client_id_from_env': True, 'client_secret_from_env': True, 'api_key_from_env': True, 'db_password_from_env': False}}
2025-08-13 11:06:51,917 - MOTHistoryImport - INFO - JSON data logging initialized. File: Logs\mot_history_data_20250813_110651.json
2025-08-13 11:06:51,933 - MOTHistoryImport - INFO - Using config rate limit: 15 RPS
2025-08-13 11:06:51,940 - MOTHistoryImport - INFO - Starting Database connection to MLNOESQLUAT01.Engineering with 15-minute retry window
2025-08-13 11:06:51,949 - MOTHistoryImport - INFO - Establishing database connection...
2025-08-13 11:06:52,060 - MOTHistoryImport - INFO - Database connection established successfully
2025-08-13 11:06:52,076 - MOTHistoryImport - DEBUG - Retrieved APIId 2 for service 'GOV MOT History Service'
2025-08-13 11:06:52,076 - MOTHistoryImport - DEBUG - Retrieved rate limit 1 seconds for APIId 2
2025-08-13 11:06:52,091 - MOTHistoryImport - INFO - Updated rate limit from 15.000 to 1.000 RPS (1s interval)
2025-08-13 11:06:52,091 - MOTHistoryImport - INFO - API logging initialized - APIId: 2, Rate Limit: 1s
2025-08-13 11:06:52,091 - MOTHistoryImport - DEBUG - API logging enabled for MOTAPIClient with APIId: 2
2025-08-13 11:06:52,091 - MOTHistoryImport - INFO - Starting MOT History Data Import (Bulk Mode)
2025-08-13 11:06:52,091 - MOTHistoryImport - INFO - Starting Database connection to MLNOESQLUAT01.Engineering with 15-minute retry window
2025-08-13 11:06:52,091 - MOTHistoryImport - INFO - Establishing database connection...
2025-08-13 11:06:52,155 - MOTHistoryImport - INFO - Database connection established successfully
2025-08-13 11:06:52,155 - MOTHistoryImport - INFO - Truncating table: StageMOTVehicles
2025-08-13 11:06:52,171 - MOTHistoryImport - INFO - Successfully truncated table: StageMOTVehicles
2025-08-13 11:06:52,171 - MOTHistoryImport - INFO - Truncating table: StageMOTTests
2025-08-13 11:06:52,187 - MOTHistoryImport - INFO - Successfully truncated table: StageMOTTests
2025-08-13 11:06:52,187 - MOTHistoryImport - INFO - Truncating table: StageMOTDefects
2025-08-13 11:06:52,204 - MOTHistoryImport - INFO - Successfully truncated table: StageMOTDefects
2025-08-13 11:06:52,204 - MOTHistoryImport - INFO - Truncating table: StageMOTVehiclesNotFound
2025-08-13 11:06:52,204 - MOTHistoryImport - INFO - Successfully truncated table: StageMOTVehiclesNotFound
2025-08-13 11:06:52,219 - MOTHistoryImport - INFO - Reading vehicle registrations from source database: MLNOESQLEXP01
2025-08-13 11:06:52,219 - MOTHistoryImport - INFO - Starting Source database connection to MLNOESQLEXP01.ML-Equinox with 15-minute retry window
2025-08-13 11:06:52,219 - MOTHistoryImport - INFO - Establishing source database connection to MLNOESQLEXP01
2025-08-13 11:06:52,425 - MOTHistoryImport - ERROR - Failed to read vehicle registrations from source database: ('42S02', "[42S02] [Microsoft][ODBC SQL Server Driver][SQL Server]Invalid object name 'dbo.vQlik_Veh_VehicleImportData'. (208) (SQLExecDirectW)")
2025-08-13 11:06:52,441 - MOTHistoryImport - ERROR - Failed to read vehicle registrations: ('42S02', "[42S02] [Microsoft][ODBC SQL Server Driver][SQL Server]Invalid object name 'dbo.vQlik_Veh_VehicleImportData'. (208) (SQLExecDirectW)")
2025-08-13 11:06:52,599 - MOTHistoryImport - INFO - Email sent successfully to cdunbar@metroline.co.uk
2025-08-13 11:06:52,599 - MOTHistoryImport - INFO - Failure notification email sent
2025-08-13 11:06:52,599 - MOTHistoryImport - ERROR - Import process failed: ('42S02', "[42S02] [Microsoft][ODBC SQL Server Driver][SQL Server]Invalid object name 'dbo.vQlik_Veh_VehicleImportData'. (208) (SQLExecDirectW)")
2025-08-13 11:06:52,615 - MOTHistoryImport - ERROR - Traceback: Traceback (most recent call last):
  File "Y:\Engineering\GOV API Data\MOT History\Python Files\GOV_API_MOTHistory_Import.py", line 2386, in run_import
    registrations = self.read_vehicle_registrations()
  File "Y:\Engineering\GOV API Data\MOT History\Python Files\GOV_API_MOTHistory_Import.py", line 2129, in read_vehicle_registrations
    source_cursor.execute(query)
pyodbc.ProgrammingError: ('42S02', "[42S02] [Microsoft][ODBC SQL Server Driver][SQL Server]Invalid object name 'dbo.vQlik_Veh_VehicleImportData'. (208) (SQLExecDirectW)")

2025-08-13 11:06:52,761 - MOTHistoryImport - INFO - Email sent successfully to cdunbar@metroline.co.uk
2025-08-13 11:06:52,774 - MOTHistoryImport - INFO - Failure notification email sent
2025-08-13 11:06:52,774 - MOTHistoryImport - INFO - FAILURE notification email sent
2025-08-13 11:06:52,790 - MOTHistoryImport - INFO - Database connection closed
